import torch
from torch.utils.data import Dataset
from datasets import load_dataset


class CompatibleSyntheticInstructGPTJPairwise(Dataset):
    """
    Synthetic dataset of instructions generated by GPT-J for pairwise comparison, made compatible with AnthropicHelpfulHarmless.
        https://huggingface.co/datasets/Dahoas/synthetic-instruct-gptj-pairwise
    """

    def __init__(self, split="train", data_dir=None):
        data = load_dataset("Dahoas/synthetic-instruct-gptj-pairwise", data_dir=data_dir)[split]
        self.prompts = data["prompt"]
        self.chosen_instructions = [f"Human: {prompt}\n\nAssistant: {chosen}" for prompt, chosen in zip(data["prompt"], data["chosen"])]
        self.rejected_instructions = [f"Human: {prompt}\n\nAssistant: {rejected}" for prompt, rejected in zip(data["prompt"], data["rejected"])]

    def __getitem__(self, idx):
        return self.chosen_instructions[idx], self.rejected_instructions[idx]

    def __len__(self):
        return len(self.prompts)
